[К списку вопросов](db_exam.md)

# 20. Хранилища “ключ-значение” на примере Redis. Структура базы данных. Основные типы данных и операции.

![](https://avatars.githubusercontent.com/u/1529926?s=200&v=4)

**Redis** (REmote DIctionary Server) — NoSQL база данных типа ключ-значение. Redis хранит данные в оперативной памяти, что является ключевой особенностью этого хранилища. Поэтому он очень быстрый, но не самый надежный. Периодически Redis сбрасывает все данные на диск, но если сервер упадет в момент между добавлением новой информации и сохранением на диск, данные будут потеряны. По этим причинам Redis часто используют не как основное хранилище, а в качестве кэша, системы управления сессиями или для решения другой задачи, где не страшно потерять данные. 

**Redis** — хранилище данных в формате «ключ-значение». Факты о ключах: 
 * Ключи в Redis — бинарно-безопасные (binary safe) строки.
 * Слишком длинные ключи — плохая идея, не только из-за занимаемой памяти, но так же и в связи с увеличением времени поиска определенного ключа в множестве в связи с дорогостоящим сравнением.
 * Хорошая идея — придерживаться схемы при построении ключей: «object-type:id:field».

## Типы данных Redis

**Redis** — это хранилище ключей и значений, но оно поддерживает многие типы структур данных в виде значений, отличных от строк. Ключ в Redis — это безопасная для двоичного кода строка с максимальным размером 512 МБ.

Давайте обсудим типы данных, которые поддерживаются в значениях.

### String

Строка в Redis — это последовательность байтов. Они безопасны для двоичного кода, поэтому имеют известную длину, которая не определяется какими-либо завершающими символами. Вы можете хранить до 512 мегабайт в строке Redis. Он может хранить данные любого типа, такие как текст, целые числа, числа с плавающей запятой, видео, изображения или аудиофайлы.

```bash
redis 127.0.0.1:6379> SET name "educative" 
OK 
redis 127.0.0.1:6379> GET name 
"educative"
```

В этом примере SETи GET представлены команды Redis, о которых мы поговорим позже. name- это ключ, а educative это строковое значение, которое мы храним.

### List

В Redis списки — это списки строк, которые отсортированы по порядку вставки, поэтому элементы хранятся в связном списке. Вы можете добавлять элементы как на голове, так и на хвосте. Если нам нужно вставить элемент в список из 500 записей, это займет столько же времени, сколько и добавление элемента в список из 50 000 записей.

Вот несколько примеров операций для составления списка результирующих списков:

```bash
LPUSH mylist x   # now the list is "x"
LPUSH mylist y   # now the list is "y","x"
RPUSH mylist z   # now the list is "y","x","z" (RPUSH was used this time)
```

### Sets

Наборы в Redis — это неупорядоченные коллекции строк. Этот тип значения аналогичен списку, но наборы не допускают дублирования, и элементы не сортируются ни в каком порядке. Вы можете добавлять или удалять участников вО (1)О ( 1 ) временная сложность.

Наборы полезны, когда мы хотим хранить данные, где важна уникальность. Например, сохранение количества уникальных посетителей веб-сайта.

### Сортированные наборы

Мы можем сортировать элементы с типом значения Sorted Set. Каждый элемент будет связан с числом, которое мы называем счетом. Это определяет порядок.

Например, если у нас есть вызванный ключ vegetables, и мы хотим сохранить carrot и celery в качестве значения. Оценка от carrot10 celery до 15. Первым будет морковь, затем сельдерей.

Если оценка двух разных элементов одинакова, мы проверяем, какая строка лексикографически больше.

### Хеш

В Redis тип хеш-значения — это пара значений поля. Они используются для представления объектов, но могут хранить множество элементов и полезны также для других задач. Хеш занимает очень мало места, поэтому вы можете хранить миллионы объектов в небольшом экземпляре хеша.

Фактически, хеш может хранить до {2} ^ {32}2Взаимодействие с другими людьми3 2Взаимодействие с другими людьми. Взаимодействие с другими людьми- 1- 1 пары поле-значение, что составляет более 4 миллиардов.

Допустим, мы хотим хранить информацию об оценках студентов. Тема может быть ключевым. Значение может быть парой «поле-значение», где поле представляет собой имя учащегося, а значение — оценку каждого учащегося.

Вот еще один пример, чтобы познакомить вас с хешем Redis.

```bash
HMSET user:1000 username antirez password P1pp0 age 34
HGETALL user:1000
HSET user:1000 password 12345
HGETALL user:1000
```

## Команды Redis

Команды Redis используются для выполнения операций. Есть разные команды, которые мы можем применять к нашим различным типам данных. Ниже мы рассмотрим по одной команде для каждого типа данных, о котором говорилось выше, но имейте в виду, что в Redis существует множество команд.

**Общие команды**

В Redis есть набор команд, которые можно применять к любому типу данных:

 * exists — возвращает 1, если ключ существует и 0, если нет.
 * del - удаляет ключ.
 * type - возвращает тип значения по ключу.
 * expire - удаляет ключ по прошествии указанного времени.
 * ttl - возвращает число: сколько времени осталось ключу до удаления.

## Хранение строк в Redis

Самая простая форма данных, которая может храниться в базе данных Redis, — это строка. Мы рассмотрим две команды, используемые для хранения и выборки записей из базы данных Redis при использовании строк.

### SET команда

Мы можем сохранить запись в Redis с помощью SET команды. Это установит ключ для хранения строкового значения. Если ключ уже содержит значение, оно будет перезаписано. Он имеет следующий синтаксис:

```bash
SET keyValue
```

### GET команда

Команда GET дает нам значение ключа. Если ключ не существует, он вернется nil. GET обрабатывает только строковые значения. Синтаксис:

```bash
GET key
```

## Хранение списков в Redis

Мы также можем хранить списки, и база данных Redis хранит их в виде связанного списка. Когда мы вставляем новый элемент, мы можем вставить его либо в голову (крайний левый элемент), либо в хвост (крайний правый элемент). Мы рассмотрим две команды, используемые для добавления и удаления записей из головы при использовании списков.

### LPUSH команда

Команда LPUSHиспользуется для вставки значения в начало списка. Мы можем использовать одно или несколько значений, а синтаксис следующий:

```bash
LPUSH key value
```

Примечание. Элементы вставляются в обратном порядке, потому что каждый элемент выбирается и вставляется в начале.

### LPOP команда

Команда LPOP используется для удаления элемента из списка в начале (или слева).

```bah
LPOP key
```

## Хранение наборов в Redis

Когда дело доходит до списка, мы допускаем дублирование элементов. Итак, если нам нужно добавить уникальные элементы, мы должны использовать набор, который хранится внутри как хеш-таблица. Это означает, что элементы хранятся случайным образом, и повторение не допускается. Давайте посмотрим на команду для добавления элемента из набора Redis.

### SADD команда

Это позволяет нам добавлять указанные члены в набор, хранящийся под ключом. Если ключ не существует, создается новый набор.

```bash
SADD key value
```

## Хранение отсортированных наборов в Redis

Элементы в наборе Redis не хранятся в каком-либо порядке. Итак, если мы хотим хранить элементы в отсортированном порядке, мы можем использовать отсортированные наборы, также называемые ZSets.

Перед вставкой каждому элементу должна быть присвоена оценка. База данных Redis сортирует элементы в порядке возрастания оценок. Посмотрим на команду добавления элементов в отсортированный набор.

### ZADD команда

Эта команда добавит элементы в отсортированный набор в базе данных Redis. Мы можем указать несколько пар очков или членов. Если член уже находится в этом отсортированном наборе, оценка обновляется, и элемент повторно вставляется в правильную позицию для сохранения оценки. Вот синтаксис:

```bash
ZADD key score value
```

## Хранение хэша в Redis

В Redis значение также может быть парой «поле-значение», которую мы называем хэш-структурой данных. Давайте посмотрим на команду для хранения хэша в Redis.

### HMSET команда

Эта команда используется для хранения хэша в Redis. Он установит для полей соответствующие значения в хэше. Эта команда перезаписывает поля, которые уже существуют в хэше. Синтаксис этой команды:

```bash
HMSET key field value
```

