[К списку вопросов](exam_oop.md)

# 6. Модель поведения объектов. Жизненный цикл и диаграмма перехода в состояния (ДПС). Виды состояний. События, данные событий. Действия состояний. Таблица перехода в состояния (ТПС). Правила переходов.

## Модель поведения объектов.
Выделяем поведение объектов. Отталкиваемся от реального физического мира. Объекты в течении времени жизни проходят некоторые стадии. То, как эволюционирует объект между стадиям, характеризует черту поведения объекта. Любой объект в данный момент времени находится в какой-то стадии.

Объект переходит из одной стадии в другую скачкообразно.

Не все переходы из одной стадии в другую возможны.

В физическом мире происходят инциденты, которые заставляют объекты переходить из одной стадии в другую. Или инциденты являются следствием перехода объекта из одной стадии в другую.

Для описания поведения объектов используем модель Мура:

- Множество состояний объекта (стадий),
- Множество событий, которые переводят объект из одной стадии в другую,
- Множество действий состояний
- Правила переходов
- Модель состояний можно формализовать таблицей и диаграммой.

## Жизненный цикл и диаграмма перехода в состояния (ДПС).
Формы жизненных циклов:
1. Циркуляционный
2. Рождение-смерть

Когда формируются жизненные циклы:
1. Создание или уничтожение во время выполнения
2. Миграция между подклассами
3. Объект производится или возникает поэтапно.
4. Объект – задача или запрос
5. Динамическая связь Для пассивных объектов мы не выделяем жизненные циклы. Но иногда мы это делаем в интересах активных объектов.

ДПС - диаграмма переходов состояний. \
Каждое состояние рисуем прямоугольником. \
Каждому состоянию присваиваем номер и имя состояния.

## Состояние. Виды состояний.
**Состояние** – это положение объектов, в котором определяются определённый набор правил, линий поведений, предписаний, определённых законов.

Виды состояний:
1. Состояние создания - в эти состояния происходим переход не из стостояния
2. Заключительные состояния: 

    2.1. Объект уничтожается - состояние рисуем пунктирной линией

   2.2. Состояние, из которого объект больше не переходит в другие состояния, но не уничтожается - рисуется как обычное состояние из которого нет переходов
3. Текущее состояние (не создания и не заключительное)

Чтобы определять текущее состояние в класс добавляется вспомогательный атрибут - статут - хранит текущее состояние. Состояния контекста - промежуточные состояния, которые определяются предыдущим и следующим состояниями. Их цель - организовать этот переход.

## События, данные событий. Действия состояний.
**Событие** – это абстракция инцидента или сигнала в реальном мире. События могут переносить данные.

Переход из одного состояние в другое происходит в результате события.

Описание события:
- Значение события - короткая фраза, которая сообщает нам, что происходит с объектом в реальном мире.
- Предназначение - это модель состояний, которое принимает событие, может быть один единственный приёмник, для данного события.
- Метка – уникальная метка должна обеспечиваться для каждого события. Внешние события помечаются буквой «Е».
- Данные события – события переносят данные. Все события, которые переносят объект из одного состояния в другое должны нести его идентификатор.

Все события, которые вызывают переход в одно и тоже состояние должны нести одни и те же данные. Идентификатор сущности, к которой применяется событие, должен переноситься как данные.

**Действие** – это деятельность или операция, которая выполняется при достижении объектом состояния. Каждому состоянию ставится в соответствие одно действие.

Что может действие:
1. Выполнять любые операции над атрибутами объекта, который переводит
2. Выполнять любые вычисления
3. Порождать события для любого объекта любого класса, в том числе и для самого себя. В том числе для чего-либо вне области анализа нашей подсистемы.
4. Выполнять любые действия над таймером - создавать, удалять, считывать, запускать, очищать.
5. Действие имеет доступ к любым атрибутам объектов любых классов.

Что обязано действие:
1. Гарантировать непротиворечивость объекта - после выполнения действия атрибуты объекта не должны противоречить друг другу.
2. При создании и удалении объектов (собственного класса) действие должно позаботиться о связях - чтобы они тоже не были противоречивыми (убиваешь мужа - переведи жену во вдовы).
3. Действие должно менять атрибут статуса на то состояние, которому оно соответствует.

Алгоритм действия можно разместить на ДПС непосредственно под действием. Описание действия - псевдокод. Если алгоритм большой - выносим его с ДПС.

**(!)** - Для данного объекта в момент времени может выполняться только одно действие. \
**(!)** - Для разных объектов действия могут выполняться одновременно. \
**(!)** - События никогда не теряются. \
**(!)** - Если событие порождено для объекта, который в данный момент выполняет действие, то оно будет принято объектом только после того, как действие будет выполнено. \
**(!)** - Событие исчезает после того, как оно было принято.

## Таблица перехода в состояния (ТПС). Правила переходов.
Есть правила, которые связывают события с состояниями:
- Все события, которые переводят объект в одно состояние, должны нести одни и те же данные.
- Правило состояния создания: событие, которое переводит объект в состояние создания, не несет идентификатор объекта
- Правило состояния несоздания (текущее): событие, которое переводит в это состояние, должно обязательно нести идентификатор объекта (как данное)

**Таблица переходов состояний** - с помощью нее мы контролируем, какие возможны переходы из одного состояния в другое.

В таблице строка - это состояние, состояния нумеруются. Столбец - это событие.

События могут игнорироваться - событие не переводит объект в новое состояние. В этом случае ставится '-'.

Если данное событие не может произойти, когда объект находится в данном состоянии, то в ячейке ставится 'x' - желательно, чтобы таких ячеек было минимум или не было.

В таблице все ячейки должны быть заполнены.
